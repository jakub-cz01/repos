create table kreatura as select * from wikingowie.kreatura;
create table uczestnicy as select * from wikingowie.uczestnicy;
create table etapy_wyprawy as select * from wikingowie.etapy_wyprawy;
create table sektor as select * from wikingowie.sektor;
create table wyprawa as select * from wikingowie.wyprawa;
select u.nazwa from (select u.id_wyprawy, k.nazwa from kreatura k left join uczestnicy u on u.id_uczestnika = k.idKreatury) u  where u.id_wyprawy is null;
select w.nazwa, y.suma from (select x.id_wyprawy, sum(x.ilosc) as suma from (select w.id_wyprawy, e.ilosc from uczestnicy w join ekwipunek e on e.idKreatury = w.id_uczestnika) x group by id_wyprawy) y join wyprawa w on w.id_wyprawy =y.id_wyprawy;
select w.nazwa, group_concat(k.nazwa), count(u.id_uczestnika) as ilosc from uczestnicy u join kreatura k on u.id_uczestnika = k.idKreatury join wyprawa w on w.id_wyprawy = u.id_wyprawy group by w.nazwa;
select e.idEtapu, w.nazwa as wyprawa, s.nazwa as sektor, e.kolejnosc, w.data_rozpoczecia, k.nazwa as kierownik from etapy_wyprawy e join wyprawa w on w.id_wyprawy = e.idWyprawy join sektor s on s.id_sektora = e.sektor join (select w.nazwa as wyprawa, k.nazwa from wyprawa w join kreatura k on k.idKreatury = w.kierownik) k on k.wyprawa = w.nazwa order by data_rozpoczecia, kolejnosc;
select s.nazwa, ifnull(i.ilosc_odwiedzin,0) as ilosc_odwiedzin from sektor s left join (select sektor, count(idEtapu) as ilosc_odwiedzin from etapy_wyprawy group by sektor order by sektor) i on s.id_sektora = i.sektor;
select b.nazwa, if(b.ilosc>0, "bral udzial w wyprawie", "nie bral udzialu w wyprawie") as udzial from (select a.nazwa, ifnull(count(a.id_wyprawy),0) as ilosc from (select u.id_wyprawy, k.nazwa from kreatura k left join uczestnicy u on u.id_uczestnika = k.idKreatury) a group by nazwa) b order by b.nazwa;
select b.nazwa, sum(a.ilosc) as suma_znakow from (select idWyprawy, length(dziennik) as ilosc from etapy_wyprawy) a join wyprawa b on b.id_wyprawy = a.idWyprawy group by b.nazwa having suma_znakow<400;
select w.nazwa, u.srednia_waga from (select e.id_wyprawy, e.waga/u.ilosc as srednia_waga from (select e.id_wyprawy, sum(e.waga) as waga from (select w.id_wyprawy, e.ilosc*e.waga as waga from (select e.idKreatury, e.idZasobu, e.ilosc, z.waga from ekwipunek e join zasob z on z.idZasobu = e.idZasobu) e join uczestnicy w on w.id_uczestnika = e.idKreatury) e group by e.id_wyprawy) e join (select id_wyprawy, count(id_uczestnika) as ilosc from uczestnicy group by id_wyprawy) u on e.id_wyprawy = u.id_wyprawy order by id_wyprawy) u join wyprawa w on w.id_wyprawy = u.id_wyprawy;
select w.nazwa as wyprawa, k.nazwa as postac, datediff(e.data_rozpoczecia, k.dataUr) as ilosc_dni from (select w.id_wyprawy, w.data_rozpoczecia from wyprawa w join (select idWyprawy, sektor from etapy_wyprawy where sektor = 7) e on e.idWyprawy = w.id_wyprawy) e join uczestnicy u on u.id_wyprawy = e.id_wyprawy join kreatura k on k.idKreatury = u.id_uczestnika join wyprawa w on w.id_wyprawy = u.id_wyprawy order by wyprawa;
