create procedure waga_spr (inout waga int) begin if waga<=0 then set waga = 1; end if; end
create trigger waga_m before update on kreatura for each row call waga_spr(new.waga)
create trigger waga_n before insert on kreatura for each row call waga_spr(new.waga)
create table archiwum_wypraw (id_wyprawy int, nazwa varchar(200), data_rozpoczecia date, data_zakonczenia date, kierownik varchar(40))
create procedure kierownik(in kierownik_i int,  out kierownik_v varchar(40)) begin select kreatura.nazwa into kierownik_v from kreatura where kreatura.idKreatury = kierownik_i; end
create trigger kopia before delete on wyprawa for each row begin call kierownik(old.kierownik, @kierownik); INSERT INTO archiwum_wypraw values (old.id_wyprawy, old.nazwa, old.data_rozpoczecia, old.data_zakonczenia, @kierownik); end;
CREATE PROCEDURE eliksir_sily(in kreatura_id int) begin  update kreatura set kreatura.udzwig = kreatura.udzwig*1.2 where kreatura.idKreatury = kreatura_id;  end
CREATE function wielkie_litery(tekst varchar(500)) returns varchar(500) begin  declare duzy_tekst varchar(500); set duzy_tekst = upper(tekst); return duzy_tekst; end
create table system_alarmowy (id_alarmu int primary key, wiadomosc varchar(200))
create trigger alarm after update on wyprawa for each row  begin  if exists(select * from (select w.id_wyprawy, u.id_uczestnika from (select w.id_wyprawy, e.sektor from wyprawa w join etapy_wyprawy e on e.idWyprawy = w.id_wyprawy and e.sektor = 7) w join uczestnicy u on u.id_wyprawy = w.id_wyprawy and u.id_uczestnika = 14) w where  w.id_wyprawy = new.id_wyprawy) then insert into system_alarmowy (wiadomosc) values ("TeÅ›ciowa nadchodzi !!!"); END IF; end
CREATE PROCEDURE udzwig(out suma int, out srednia int, out maks int) begin  select sum(kreatura.udzwig) from kreatura into suma; select avg(kreatura.udzwig) from kreatura into srednia; select max(kreatura.udzwig) from kreatura into maks;  end
CREATE PROCEDURE sektory(in idwyprawy int, out nazwa varchar(500)) begin declare dlugosc int; declare i int; set i = 1; set nazwa = ''; set dlugosc = (select max(kolejnosc) as maks from etapy_wyprawy where idWyprawy = idwyprawy); repeat set nazwa = concat(nazwa, ' ', i, '. ', (select concat(s.wspolrzedna, ' ', s.nazwa) from (select e.idWyprawy, s.nazwa, concat(s.wspolrzedna_x, s.wspolrzedna_y) as wspolrzedna, e.kolejnosc from etapy_wyprawy e join sektor s on s.id_sektora = e.sektor) s where s.kolejnosc = i and s.idWyprawy = idwyprawy)); set i = i+1; until i=dlugosc+1 end repeat; end